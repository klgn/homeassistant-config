- id: '1643822863833'
  alias: Emmas remote
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.emma_remote_brightness
    id: brightness
  - platform: state
    entity_id: sensor.emma_remote_action
    id: 'on'
    to: 'on'
  - platform: state
    entity_id: sensor.emma_remote_action
    id: 'off'
    to: 'off'
  - platform: state
    entity_id: sensor.emma_remote_action
    id: left-click
    to: arrow_left_click
  - platform: state
    entity_id: sensor.emma_remote_action
    id: right-click
    to: arrow_right_click
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - service: light.turn_on
        target:
          entity_id: light.emmas_strip
        data: {}
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: light.turn_off
        target:
          entity_id: light.emmas_strip
        data: {}
    - conditions:
      - condition: trigger
        id: left-click
      sequence:
      - service: light.turn_on
        target:
          entity_id: light.emmas_strip
        data:
          hs_color:
          - "{% if state_attr(var_light, \"hs_color\")[0] - 18 < 0 %}\n  {{ 360 -
            state_attr(var_light, \"hs_color\")[0] - 18 }}\n{% else %}\n  {{ state_attr(var_light,
            \"hs_color\")[0] - 18 }}\n{% endif %}"
          - '{{ state_attr(var_light, "hs_color")[1] }}'
          transition: 0.5
      - delay:
          milliseconds: 500
    - conditions:
      - condition: trigger
        id: right-click
      sequence:
      - service: light.turn_on
        target:
          entity_id: light.emmas_strip
        data:
          hs_color:
          - "{% if state_attr(var_light, \"hs_color\")[0] + 18 > 360 %}\n  {{ state_attr(var_light,
            \"hs_color\")[0] + 18 - 360 }}\n{% else %}\n  {{ state_attr(var_light,
            \"hs_color\")[0] + 18 }}\n{% endif %}"
          - '{{ state_attr(var_light, "hs_color")[1] }}'
          transition: 0.5
    default: []
  mode: single
  variables:
    var_light: light.emmas_strip
- id: '1653921061156'
  alias: Update notifications
  description: ''
  use_blueprint:
    path: mdegat01/update_notifications.yaml
    input:
      reminder_hours: '3'
      update_entities:
      - update.home_assistant_core_update
      - update.home_assistant_operating_system_update
      - update.home_assistant_supervisor_update
      - update.studio_code_server_update
      - update.adguard_home_update
      - update.duck_dns_update
      - update.mosquitto_broker_update
      - update.zigbee2mqtt_update
      - update.wireguard_update
      - update.terminal_ssh_update
      - update.samba_share_update
      - update.home_assistant_google_drive_backup_update
      - update.influxdb_update
      mobile_app_device: 49007877174341f3f8961213599c583f
- id: '1655043793601'
  alias: Astrids lights
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 957414c082d6a974ad5157d047420dfb
    type: action
    subtype: toggle
    discovery_id: 0xbc33acfffe83dc24 action_toggle
    id: toggle
  condition: []
  action:
  - service: light.toggle
    data: {}
    target:
      entity_id: light.astrid_s_lights
  mode: single
- id: '1656424147667'
  alias: Set Washing Machine States
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.shelly_shplg_s_f1487f_current_consumption
    id: 'off'
    for:
      hours: 0
      minutes: 1
      seconds: 0
    below: '1'
  - platform: numeric_state
    entity_id: sensor.shelly_shplg_s_f1487f_current_consumption
    id: running
    above: '1'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: input_select.select_option
        data:
          option: 'Off'
        target:
          entity_id: input_select.washing_machine_status
    - conditions:
      - condition: trigger
        id: 'off'
      - condition: state
        entity_id: input_select.washing_machine_status
        state: Running
      sequence:
      - service: input_select.select_option
        data:
          option: Finished
        target:
          entity_id: input_select.washing_machine_status
    - conditions:
      - condition: trigger
        id: running
      sequence:
      - service: input_select.select_option
        data:
          option: Running
        target:
          entity_id: input_select.washing_machine_status
    default: []
  mode: single
- id: '1656424427614'
  alias: Notify - Washing machine finished
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_select.washing_machine_status
    to: 'Off'
    from: Running
  condition: []
  action:
  - service: notify.mobile_app_klgn_phone
    data:
      message: Washing machine is done
      data:
        persisent: true
        tag: washing
        actions:
        - action: MACHINE_EMPTIED
          title: It's done
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.washing_machine_emptied
  mode: single
- id: '1656424680283'
  alias: Notify - Washing machine emptied action
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification
    event_data:
      action: MACHINE_EMPTIED
  condition: []
  action:
  - service: notify.mobile_app_klgn_phone
    data:
      message: clear_notification
      data:
        tag: washing
  - service: input_boolean.turn_off
    data: {}
  mode: single
- id: '1657113186860'
  alias: Notify When general waste is collected
  description: ''
  use_blueprint:
    path: klgn/renoweb_waste_blueprint.yaml
    input:
      waste: sensor.renoweb_240_l_rest_mad_14_dag
      mobile_app_device: 49007877174341f3f8961213599c583f
- id: '1659546576401'
  alias: Update previous hour price
  description: ''
  trigger:
  - platform: time_pattern
    minutes: '59'
  condition: []
  action:
  - service: input_number.set_value
    data:
      value: '{% set _price_obj = state_attr(''sensor.energy_price'', ''today'') |
        selectattr(''hour_only'', ''=='', now().timestamp() | timestamp_custom("%H"))
        | list %} {{ _price_obj[0][''price''] }}

        '
    target:
      entity_id: input_number.previous_hour_price
  mode: single
- id: '1659547210990'
  alias: Update Hourly Electricity price
  description: ''
  trigger:
  - platform: time_pattern
    minutes: '0'
    seconds: '30'
  condition: []
  action:
  - service: input_number.set_value
    data:
      value: '{{ state_attr(''sensor.hourly_power_usage'', ''last_period'') | float
        * states.input_number.previous_hour_price.state | float }}

        '
    target:
      entity_id: input_number.hourly_energy_price
  mode: single
- id: '1663350945169'
  alias: Toggle Sonos from Alarm State
  description: ''
  trigger:
  - platform: state
    entity_id:
    - alarm_control_panel.verisure_alarm
    id: away
    to: armed_away
  - platform: state
    entity_id:
    - alarm_control_panel.verisure_alarm
    id: home
    to: disarmed
  - platform: state
    entity_id:
    - alarm_control_panel.verisure_alarm
    id: arm-home
    to: armed_home
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: away
      sequence:
      - service: switch.turn_off
        data: {}
        target:
          entity_id:
          - switch.office_sonos_switch
          - switch.shelly_shplg_s_f1a39a
    - conditions:
      - condition: trigger
        id: home
      sequence:
      - service: switch.turn_on
        data: {}
        target:
          entity_id:
          - switch.office_sonos_switch
          - switch.shelly_shplg_s_f1a39a
    - conditions:
      - condition: trigger
        id: arm-home
      sequence:
      - service: switch.turn_off
        data: {}
        target:
          entity_id:
          - switch.office_sonos_switch
          - switch.shelly_shplg_s_f1a39a
  mode: single
- id: '1663351083369'
  alias: Turn off Living Sonos Bulp when switch is turned on
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.shelly_shplg_s_f1a39a
    to: 'on'
    id: turn-on
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: turn-on
      sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.living_room_sonos_bulp
  mode: single
- id: '1664647979067'
  alias: Living Room morning schedule
  description: ''
  trigger:
  - platform: time
    at: input_datetime.living_room_light_morning_schedule_start
    id: morning-start
  - platform: time
    at: input_datetime.living_room_light_morning_schedule_end
    id: morning-end
  - platform: numeric_state
    entity_id: sensor.sun_elevation
    id: sun-up
    above: '1'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.vacation
      state: 'off'
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'on'
    - condition: state
      entity_id: person.kristian_l_g_nielsen
      state: home
    - condition: state
      entity_id: input_boolean.guestmode
      state: 'off'
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: morning-start
      sequence:
      - service: switch.turn_on
        target:
          entity_id: switch.living_room_control_unit
        data: {}
    - conditions:
      - condition: trigger
        id: morning-end
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.living_room_control_unit
        data: {}
    - conditions:
      - condition: trigger
        id: sun-up
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.living_room_control_unit
        data: {}
    default: []
  mode: single
- id: sonos_living_room_morning_schedule
  alias: 'Sonos: Living Room morning schedule '
  description: ''
  trigger:
  - platform: time
    at: input_datetime.living_room_sonos_morning_start
    id: morning-start
  - platform: time
    at: input_datetime.living_room_sonos_morning_end
    id: morning-end
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'on'
    - condition: state
      entity_id: input_boolean.vacation
      state: 'off'
    - condition: state
      entity_id: person.kristian_l_g_nielsen
      state: home
  action:
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id: morning-start
        - condition: state
          entity_id: device_tracker.klgn_phone
          state: home
      sequence:
      - service: automation.trigger
        target:
          entity_id: automation.living_room_p4_kobenhavn
        data: {}
    - conditions:
      - condition: trigger
        id: morning-end
      sequence:
      - service: media_player.media_stop
        target:
          entity_id: media_player.living_room
        data: {}
    default: []
  mode: single
- id: living_room_lights_when_dark
  alias: Turn on lights in living room when dark outside
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.sun_elevation
    below: '1.0'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.guestmode
      state: 'off'
    - condition: state
      entity_id: alarm_control_panel.verisure_alarm
      state: disarmed
  action:
  - service: light.turn_on
    data: {}
    target:
      entity_id: light.living_room_control_unit
  mode: single
- id: kids_internet_schedule
  alias: Kids' Internet Schedule
  description: ''
  trigger:
  - platform: time
    at: input_datetime.kids_internet_curfew_end
    id: morning-curfew
  - platform: time
    at: input_datetime.kids_internet_curfew_start
    id: evening-curfew
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: morning-curfew
      sequence:
      - service: switch.turn_on
        data: {}
        target:
          entity_id: switch.laurits_laptop
      - service: switch.turn_on
        data: {}
        target:
          entity_id:
          - switch.astrids_laptop
      - service: switch.turn_on
        data: {}
        target:
          entity_id: switch.emmas_laptop
    - conditions:
      - condition: trigger
        id: evening-curfew
      sequence:
      - service: switch.turn_off
        data: {}
        target:
          entity_id:
          - switch.laurits_laptop
      - service: switch.turn_off
        data: {}
        target:
          entity_id: switch.astrids_laptop
      - service: switch.turn_off
        data: {}
        target:
          entity_id: switch.emmas_laptop
    default: []
  mode: single
- id: '1664649038611'
  alias: Alarm status changed
  description: ''
  trigger:
  - platform: state
    entity_id: alarm_control_panel.verisure_alarm
  action:
  - service: notify.mobile_app_klgn_phone
    data:
      message: 'Alarm changed from {{ trigger.from_state.state }} to {{ trigger.to_state.state
        }} by {{ trigger.to_state.attributes.changed_by }}

        '
- id: living_room_p4_kobenhavn
  alias: 'Sonos: Living Room Play P4 København'
  description: ''
  trigger: []
  condition: []
  action:
  - service: media_player.volume_set
    data:
      volume_level: 0.1
    target:
      entity_id: media_player.living_room
  - service: media_player.select_source
    data:
      source: DR P4 København
    target:
      entity_id: media_player.living_room
  - service: media_player.media_play
    target:
      entity_id: media_player.living_room
  mode: single
- id: '1665207930179'
  alias: Pantry Room Notification
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.pantry_room_sensor_occupancy
    to: 'on'
    id: detected
  condition: []
  action:
  - service: notify.mobile_app_klgn_phone
    data:
      message: Someone's in the Pantry Room!!!
      title: Pantry Room activity
  mode: single
- id: '1665208238398'
  alias: Toggle toilet lights
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.toilet_sensor_occupancy
    id: turn-on
    to: 'on'
  - platform: state
    entity_id:
    - binary_sensor.toilet_sensor_occupancy
    id: turn-off
    to: 'off'
  - platform: numeric_state
    entity_id: sensor.sun_elevation
    below: 2
    id: sun-down
  - platform: numeric_state
    entity_id: sensor.sun_elevation
    above: 2
    id: sun-up
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: turn-off
      sequence:
      - service: light.turn_off
        target:
          entity_id: light.toilet_bulbs
        data: {}
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id: turn-on
      sequence:
      - service: light.turn_on
        data:
          brightness: 255
        target:
          entity_id: light.toilet_bulbs
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id: turn-on
        - condition: trigger
          id: sun-down
      sequence:
      - service: light.turn_on
        data:
          brightness: 10
        target:
          entity_id: light.toilet_bulbs
    default: []
  mode: single
- id: waste_collection
  alias: Notification Trash being collected
  description: Sends a notification to Kristian on the day that waste is being collected
  trigger:
  - platform: state
    entity_id:
    - sensor.renoweb_370_l_to_delt_pappi
    id: paper-collected
    from: '2'
    to: '1'
  - platform: state
    entity_id:
    - sensor.renoweb_240_l_glas_metal
    id: glass-collected
    from: '2'
    to: '1'
  - platform: state
    entity_id:
    - sensor.renoweb_240_l_rest_mad_14_dag
    id: general-collected
    from: '2'
    to: '1'
  - platform: state
    entity_id:
    - sensor.renoweb_rod_boks
    from: '2'
    to: '1'
    id: red-box
  - platform: state
    entity_id:
    - sensor.renoweb_tekstilposer
    from: '2'
    to: '1'
    id: textile
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: paper-collected
      sequence:
      - service: notify.mobile_app_klgn_phone
        data:
          title: Waste collection tomorrow
          message: Paper waste is collected tomorrow
      - service: notify.mobile_app_sm_a405fn
        data:
          message: Paper waste is collected tomorrow
          title: Waste collection tomorrow
    - conditions:
      - condition: trigger
        id: glass-collected
      sequence:
      - service: notify.mobile_app_klgn_phone
        data:
          title: Waste is collected tomorrow
          message: Glass and metal waste is collected tomorrow
      - service: notify.mobile_app_sm_a405fn
        data:
          title: Waste is collected tomorrow
          message: Glass and metal waste is collected tomorrow
    - conditions:
      - condition: trigger
        id: general-collected
      sequence:
      - service: notify.mobile_app_klgn_phone
        data:
          title: Waste is collected tomorrow
          message: General waste is collected tomorrow
      - service: notify.mobile_app_sm_a405fn
        data:
          message: General waste is collected tomorrow
          title: Waste is collected tomorrow
    - conditions:
      - condition: trigger
        id: red-box
      sequence:
      - service: notify.mobile_app_klgn_phone
        data:
          message: Chemical waste is collected tomorrow
          title: Waste is collected tomorrow
      - service: notify.mobile_app_sm_a405fn
        data:
          title: Waste is collected tomorrow
          message: Chemical waste is collected tomorrow
    - conditions:
      - condition: trigger
        id: textile
      sequence:
      - service: notify.mobile_app_klgn_phone
        data:
          title: Waste is collected tomorrow
          message: Textile waste is collected tomorrow
      - service: notify.mobile_app_sm_a405fn
        data:
          message: Textile waste is collected tomorrow
          title: Waste is collected tomorrow
    default: []
  mode: single
- id: '1666078197344'
  alias: Everyday alarm
  description: ''
  trigger:
  - platform: time
    at: input_datetime.home_alarm_on_at_night
    id: alarm-start
  - platform: time
    at: input_datetime.home_alarm_off_in_the_morning
    id: alarm-end
  condition:
  - condition: state
    entity_id: input_boolean.house_mode_away
    state: 'off'
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: alarm-start
      sequence:
      - service: alarm_control_panel.alarm_arm_home
        data:
          code: 8532
        target:
          entity_id: alarm_control_panel.verisure_alarm
    - conditions:
      - condition: trigger
        id: alarm-end
      sequence:
      - service: alarm_control_panel.alarm_disarm
        data:
          code: 8532
        target:
          entity_id: alarm_control_panel.verisure_alarm
    default: []
  mode: single
- id: '1666078306630'
  alias: Arm Alarm in the morning
  description: ''
  trigger:
  - platform: time
    at: input_datetime.arm_alarm_workday_time
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'on'
    - condition: state
      entity_id: input_boolean.work_from_home_today
      state: 'off'
    - condition: state
      entity_id: input_boolean.vacation
      state: 'off'
    - condition: state
      entity_id: input_boolean.guestmode
      state: 'off'
  action:
  - service: alarm_control_panel.alarm_arm_away
    data:
      code: 8532
    target:
      entity_id: alarm_control_panel.verisure_alarm
  mode: single
- id: '1666078370422'
  alias: Ask if working remotely
  description: ''
  trigger:
  - platform: time
    at: input_datetime.ask_working_remote_time
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'on'
    - condition: state
      entity_id: input_boolean.vacation
      state: 'off'
  action:
  - service: notify.mobile_app_klgn_phone
    data:
      message: Are you working remotely today?
      data:
        actions:
        - action: WORK_REMOTELY_YES
          title: 'YES'
        - action: WORK_REMOTELY_NO
          title: 'NO'
  mode: single
- id: '1666078413588'
  alias: Astrid Morning Alarm
  description: ''
  trigger:
  - platform: time
    at: input_datetime.astrid_alarm_start
    id: morning-start
  - platform: time
    at: input_datetime.astrid_alarm_end
    id: morning-end
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'on'
    - condition: state
      entity_id: input_boolean.vacation
      state: 'off'
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: morning-start
      sequence:
      - service: automation.trigger
        target:
          entity_id: automation.sonos_start_astrid_alarm
        data: {}
      - service: media_player.select_source
        data:
          source: Bangers - the sequel
        target:
          entity_id: media_player.astrids_sonos
    default: []
  mode: single
- id: '1666078503672'
  alias: Control alarm with home/away button
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_boolean.house_mode_away
    id: away
    to: 'on'
  - platform: state
    entity_id:
    - input_boolean.house_mode_away
    id: home
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id: away
        - condition: not
          conditions:
          - condition: state
            entity_id: alarm_control_panel.verisure_alarm
            state: armed_away
      sequence:
      - service: alarm_control_panel.alarm_arm_away
        data:
          code: 8532
        target:
          entity_id: alarm_control_panel.verisure_alarm
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id: home
      - condition: state
        entity_id: alarm_control_panel.verisure_alarm
        state: armed_away
      sequence:
      - service: alarm_control_panel.alarm_disarm
        data: {}
    default: []
  mode: single
- id: '1666078902479'
  alias: Control Unit living room toggle
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.living_room_button_action
    to: 'on'
  condition: []
  action:
  - service: switch.toggle
    target:
      entity_id: switch.living_room_control_unit
    data: {}
  mode: single
- id: '1666079166095'
  alias: Light Pantry light
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.pantry_room_sensor_occupancy
    id: turn-on
    to: 'on'
  - platform: state
    entity_id: binary_sensor.pantry_room_sensor_occupancy
    id: turn-off
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: turn-on
      sequence:
      - service: light.turn_on
        target:
          entity_id: light.pantry_light
        data: {}
    - conditions:
      - condition: trigger
        id: turn-off
      sequence:
      - service: light.turn_off
        target:
          entity_id: light.pantry_light
        data: {}
    default: []
  mode: single
- id: '1666079193992'
  alias: Light utility room toggle
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.utility_room_button_action
    to: 'on'
  condition: []
  action:
  - service: light.toggle
    target:
      entity_id: light.utility_room_light
    data: {}
  mode: single
- id: '1666079237576'
  alias: Office Styrbar
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.office_styrbar_brightness
    id: brightness
  - platform: state
    entity_id: sensor.office_styrbar_action
    id: 'on'
    to: 'on'
  - platform: state
    entity_id: sensor.office_styrbar_action
    id: 'off'
    to: 'off'
  - platform: state
    entity_id: sensor.office_styrbar_action
    id: up-hold
    to: brightness_move_up
  - platform: state
    entity_id: sensor.office_styrbar_action
    id: down-hold
    to: brightness_move_down
  - platform: state
    entity_id: sensor.office_styrbar_action
    id: left-hold
    to: arrow_left_hold
  - platform: state
    entity_id: sensor.office_styrbar_action
    id: right-hold
    to: arrow_right_hold
  - platform: state
    entity_id: sensor.office_styrbar_action
    id: left-click
    to: arrow_left_click
  - platform: state
    entity_id: sensor.office_styrbar_action
    id: right-click
    to: arrow_right_click
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - service: light.turn_on
        target:
          entity_id:
          - light.office_bulp
          - light.office_strip
        data: {}
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: light.turn_off
        target:
          entity_id:
          - light.office_bulp
          - light.office_strip
        data: {}
    - conditions:
      - condition: trigger
        id: right-hold
      sequence:
      - service: switch.turn_on
        target:
          entity_id: switch.office_control_unit
        data: {}
    - conditions:
      - condition: trigger
        id: left-hold
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.office_control_unit
        data: {}
    - conditions:
      - condition: trigger
        id: left-click
      sequence:
      - service: light.turn_on
        target:
          entity_id:
          - light.office_bulp
        data:
          hs_color:
          - "{% if state_attr(var_light, \"hs_color\")[0] - 18 < 0 %}\n  {{ 360 -
            state_attr(var_light, \"hs_color\")[0] - 18 }}\n{% else %}\n  {{ state_attr(var_light,
            \"hs_color\")[0] - 18 }}\n{% endif %}"
          - '{{ state_attr(var_light, "hs_color")[1] }}'
          transition: 0.5
      - delay:
          milliseconds: 500
    - conditions:
      - condition: trigger
        id: right-click
      sequence:
      - service: light.turn_on
        target:
          entity_id:
          - light.office_bulp
        data:
          hs_color:
          - "{% if state_attr(var_light, \"hs_color\")[0] + 18 > 360 %}\n  {{ state_attr(var_light,
            \"hs_color\")[0] + 18 - 360 }}\n{% else %}\n  {{ state_attr(var_light,
            \"hs_color\")[0] + 18 }}\n{% endif %}"
          - '{{ state_attr(var_light, "hs_color")[1] }}'
          transition: 0.5
    default: []
  mode: single
  variables:
    var_light: light.office_strip
- id: '1666079269919'
  alias: Reset work remotely
  description: ''
  trigger:
  - platform: time
    at: input_datetime.reset_work_remotely_time
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'on'
    - condition: state
      entity_id: input_boolean.vacation
      state: 'off'
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.work_from_home_today
  mode: single
- id: '1666079312415'
  alias: 'Sonos: Start Astrid Alarm'
  description: ''
  trigger: []
  condition: []
  action:
  - service: media_player.volume_set
    data:
      volume_level: 0.2
    target:
      entity_id: media_player.astrids_sonos
  - service: media_player.shuffle_set
    data:
      shuffle: true
    target:
      entity_id: media_player.astrids_sonos
  - service: media_player.select_source
    data:
      source: Bangers - the sequel
    target:
      entity_id: media_player.astrids_sonos
  - service: media_player.media_play
    target:
      entity_id: media_player.astrids_sonos
    data: {}
  mode: single
- id: '1666079336846'
  alias: 'Sonos: Stop Kids'' players at night'
  description: ''
  trigger:
  - platform: time
    at: input_datetime.kids_sonos_players_stop
  condition: []
  action:
  - service: media_player.media_stop
    target:
      entity_id:
      - media_player.astrids_sonos
      - media_player.emmas_vaerelse
      - media_player.laurits_sonos
    data: {}
  mode: single
- id: '1666079365648'
  alias: 'Telegram: Start Astrid Alarm'
  description: ''
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
      command: /upAstrid
  condition: []
  action:
  - service: automation.trigger
    target:
      entity_id: automation.sonos_start_astrid_alarm
    data: {}
  mode: single
- id: '1666079376655'
  alias: 'Telegram: Start Charging Mower'
  description: ''
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
      command: /chargeMower
  condition: []
  action:
  - service: switch.turn_on
    target:
      entity_id: switch.control_unit_1
    data: {}
  - service: telegram_bot.send_message
    data:
      message: Started charging the mower
  mode: single
- id: '1666079388258'
  alias: 'Telegram: Start Living Room Sonos'
  description: ''
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
      command: /goodmorning
  condition: []
  action:
  - service: automation.trigger
    target:
      entity_id: automation.living_room_p4_kobenhavn
    data: {}
  mode: single
- id: '1666079439792'
  alias: Toggle Home/Away Using Alarm
  description: ''
  trigger:
  - platform: state
    entity_id: alarm_control_panel.verisure_alarm
    id: home
    to: disarmed
  - platform: state
    entity_id: alarm_control_panel.verisure_alarm
    id: away
    to: armed_away
  condition: []
  action:
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id: home
        - condition: not
          conditions:
          - condition: state
            entity_id: input_boolean.house_mode_away
            state: 'off'
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.house_mode_away
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id: away
        - condition: not
          conditions:
          - condition: state
            entity_id: alarm_control_panel.verisure_alarm
            state: armed_away
      sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.house_mode_away
    default: []
  mode: single
- id: '1666079560474'
  alias: Turn everything off
  description: ''
  trigger: []
  condition: []
  action:
  - service: media_player.media_stop
    target:
      entity_id:
      - media_player.astrids_sonos
      - media_player.living_room
      - media_player.laurits_sonos
      - media_player.emmas_vaerelse
      - media_player.office
    data: {}
  - service: switch.turn_off
    target:
      entity_id:
      - switch.office_control_unit
      - switch.control_unit_1
      - switch.living_room_control_unit
      - switch.banquet_hall_control_unit
    data: {}
  - service: light.turn_off
    target:
      entity_id:
      - light.all_lights
    data: {}
  mode: single
- id: '1666079589004'
  alias: Turn off charging unit at night
  description: ''
  trigger:
  - platform: time
    at: input_datetime.hall_charger_end_time
  condition: []
  action:
  - type: turn_off
    device_id: 9ba1e1178dd56b582d4de26be35124f3
    entity_id: switch.charge_unit_l1
    domain: switch
  - type: turn_off
    device_id: 9ba1e1178dd56b582d4de26be35124f3
    entity_id: switch.charge_unit_l2
    domain: switch
  - type: turn_off
    device_id: 9ba1e1178dd56b582d4de26be35124f3
    entity_id: switch.charge_unit_l3
    domain: switch
  mode: single
- id: '1666079667089'
  alias: Turn on Workshop Control Unit for 3 hours
  description: ''
  trigger:
  - platform: state
    entity_id: switch.control_unit_1
    to: 'on'
  condition: []
  action:
  - service: timer.start
    entity_id: timer.workshop_switch
  mode: single
- id: '1666079718247'
  alias: Turn off Workshop Control Unit once Timer runs out
  description: ''
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.workshop_switch
  - platform: state
    entity_id: switch.control_unit_1
    to: 'off'
  condition: []
  action:
  - service: timer.cancel
    data:
      entity_id: timer.workshop_switch
  - service: switch.turn_off
    entity_id: switch.control_unit_1
  mode: single
- id: '1666079763585'
  alias: Wait for mobile response
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: WORK_REMOTELY_YES
    id: work-remotely-yes
  - platform: event
    event_type: mobile_app_notification_action
    id: work-remotely-no
    event_data:
      action: WORK_REMOTELY_NO
  condition:
  - condition: state
    entity_id: input_boolean.vacation
    state: 'off'
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: work-remotely-yes
      sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.work_from_home_today
    - conditions:
      - condition: trigger
        id: work-remotely-no
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.work_from_home_today
    default: []
  mode: single
- id: '1666079789109'
  alias: Workshop lightstrip toggle
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.workshop_sensor_occupancy
    id: turn-on
    to: 'on'
  - platform: state
    entity_id: binary_sensor.workshop_sensor_occupancy
    id: turn-off
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: turn-on
      sequence:
      - service: light.turn_on
        target:
          entity_id: light.workshop_strip
        data: {}
    - conditions:
      - condition: trigger
        id: turn-off
      sequence:
      - service: light.turn_off
        target:
          entity_id: light.workshop_strip
        data: {}
    default: []
  mode: single
- id: '1666079819744'
  alias: Zigbee Device Joined Notification
  description: ''
  trigger:
  - platform: mqtt
    topic: zigbee2mqtt/bridge/log
  condition:
  - condition: template
    value_template: '{{trigger.payload_json.type == "pairing" and trigger.payload_json.message
      == "interview_successful"}}'
  action:
  - service: persistent_notification.create
    data_template:
      title: Device joined the zigbee2mqtt network
      message: 'Name: {{trigger.payload_json.meta.friendly_name}}, Vendor: {{trigger.payload_json.meta.vendor}},
        Description: {{trigger.payload_json.meta.description}}'
  mode: single
- id: '1666079831524'
  alias: Zigbee Join Disabled
  description: ''
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.zigbee_permit_join
  - platform: state
    entity_id: switch.zigbee2mqtt_main_join
    to: 'off'
  condition: []
  action:
  - service: timer.cancel
    data:
      entity_id: timer.zigbee_permit_join
  - service: switch.turn_off
    entity_id: switch.zigbee2mqtt_main_join
  mode: single
- id: '1666079842056'
  alias: Zigbee Join Enabled
  description: ''
  trigger:
  - platform: state
    entity_id: switch.zigbee2mqtt_main_join
    to: 'on'
  condition: []
  action:
  - service: timer.start
    entity_id: timer.zigbee_permit_join
  mode: single
- id: '1666079854150'
  alias: Zigbee2mqtt Log Level
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.zigbee2mqtt_log_level
  condition: []
  action:
  - service: mqtt.publish
    data:
      payload_template: '{{ states(''input_select.zigbee2mqtt_log_level'') }}'
      topic: zigbee2mqtt/bridge/config/log_level
  mode: single
  initial_state: 'on'
- id: '1666079943355'
  alias: Notify when backup stale
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.backups_stale
    from: 'on'
  condition: []
  action:
  - service: notify.mobile_app_klgn_phone
    data:
      title: Backups are stale
      message: Backups are failing, please fix
  mode: single
- id: '1666348293270'
  alias: Set Electricity Price
  description: ''
  trigger:
  - platform: time
    at: input_datetime.electricity_day_tariff_start
    id: day-start
  - platform: time
    at: input_datetime.electricity_night_tariff_start
    id: night-start
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: day-start
      sequence:
      - service: input_number.set_value
        data:
          value: '{{ states.input_number.electricity_day_tariff.state | float }}

            '
        target:
          entity_id: input_number.electricity_price
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.night_electricity_tariff_on
    - conditions:
      - condition: trigger
        id: night-start
      sequence:
      - service: input_number.set_value
        data:
          value: '{{ states.input_number.electricity_night_tariff.state | float }}

            '
        target:
          entity_id: input_number.electricity_price
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.night_electricity_tariff_on
  mode: single
- id: '1666357170120'
  alias: Office Strip as slave from Office Bulb
  description: ''
  trigger:
  - platform: state
    entity_id:
    - light.office_bulp
    attribute: brightness
    id: brightness
  - platform: state
    entity_id:
    - light.office_bulp
    attribute: hs_color
    id: color
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: brightness
      sequence:
      - service: light.turn_on
        data:
          brightness: '{% set color = state_attr(''light.office_bulp'', ''brightness'')
            | float %}

            {{ color }}

            '
        target:
          entity_id: light.office_strip
    - conditions:
      - condition: trigger
        id: color
      sequence:
      - service: light.turn_on
        data:
          hs_color: '{% set color = state_attr(''light.office_bulp'', ''hs_color'')
            %}

            {{ color }}

            '
        target:
          entity_id: light.office_strip
  mode: single
- id: '1666359702996'
  alias: Hall Dimmer
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.hall_dimmer_brightness
    id: brightness
  - platform: state
    entity_id:
    - sensor.hall_dimmer_action
    to: 'on'
    id: 'on'
  - platform: state
    entity_id:
    - sensor.hall_dimmer_action
    id: 'off'
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - service: light.turn_on
        target:
          entity_id: light.hall_lights
        data:
          brightness: '{{ states.sensor.hall_dimmer_brightness.state | float }}

            '
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.hall_lights
    - conditions:
      - condition: trigger
        id: brightness
      sequence:
      - service: light.turn_on
        data:
          brightness: '{{ state_attr(''sensor.hall_dimmer_brightness'', ''state'')
            | float }}

            '
  mode: single
- id: '1666360654338'
  alias: Bedroom dimmer
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.bedroom_dimmer_brightness
    id: brightness
  - platform: state
    entity_id:
    - sensor.bedroom_dimmer_action
    to: 'on'
    id: 'on'
  - platform: state
    entity_id:
    - sensor.bedroom_dimmer_action
    id: 'off'
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - service: light.turn_on
        data:
          brightness: '{{ states.sensor.bedroom_dimmer_brightness.state | float }}

            '
        target:
          entity_id: light.bedroom_lights
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.bedroom_lights
    - conditions:
      - condition: trigger
        id: brightness
      - condition: state
        entity_id: light.bedroom_lights
        state: 'on'
      sequence:
      - service: light.turn_on
        data:
          brightness: '{{ states.sensor.bedroom_dimmer_brightness.state | float }}

            '
        target:
          entity_id: light.bedroom_lights
  mode: single
- id: '1666360971602'
  alias: Rotater
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.rotater_brightness
    id: brightness
  - platform: state
    entity_id:
    - sensor.rotater_action_2
    to: toggle
    id: toggle
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: brightness
      - condition: state
        entity_id: light.bedside_bulb
        state: 'on'
      sequence:
      - service: light.turn_on
        data:
          brightness: '{{ states.sensor.rotater_brightness.state | float }}

            '
        target:
          entity_id: light.bedside_bulb
    - conditions:
      - condition: trigger
        id: toggle
      sequence:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.bedside_bulb
  mode: single
- id: '1670168839221'
  alias: Notify when a device has low battery
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.low_battery_devices
    above: 0
    id: 'on'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - service: notify.mobile_app_klgn_phone
        data:
          message: "Low battery detected in these devices:\n  {{ state_attr('sensor.low_battery_devices',
            'sensors') | join(', ') }}\n"
          data:
            persisent: true
            tag: battery
            actions:
            - action: BATTERY_CHANGED
              title: Changed it
  mode: single
- id: '1670179192592'
  alias: Kitchen button
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.kitchen_button_action
    to: 'on'
  condition: []
  action:
  - service: light.toggle
    data: {}
    target:
      entity_id: light.kitchen_strip
  mode: single
- id: '1673040731243'
  alias: Set electricity tarfiffs
  description: ''
  trigger:
  - platform: time
    at: input_datetime.electricity_day_tariff_start
    id: day-start
    variables:
      tariff: day
  - platform: time
    at: input_datetime.electricity_night_tariff_start
    id: night-start
    variables:
      tariff: night
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: day-start
      sequence:
      - service: select.select_option
        data:
          option: day
        target:
          entity_id: select.daily_electricity
      - service: select.select_option
        data:
          option: day
        target:
          entity_id: select.monthly_electricity
    - conditions:
      - condition: trigger
        id: night-start
      sequence:
      - service: select.select_option
        data:
          option: night
        target:
          entity_id: select.daily_electricity
      - service: select.select_option
        data:
          option: night
        target:
          entity_id: select.monthly_electricity
  mode: single
